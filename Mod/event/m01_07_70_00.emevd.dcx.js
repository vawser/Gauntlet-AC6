// ==EMEVD==
// @docs    ac6-common.emedf.json
// @compress    DCX_KRAK_MAX
// @game    Sekiro
// @string    "W:\\FNR\\data\\Param\\event\\common_func.emevd\u0000\u0000\u0000\u0000\u0000\u0000\u0000"
// @linked    [0]
// @version    3.4.2
// ==/EMEVD==

Event(0, Default, function() {
    //===============
    // Trial System
    //===============
    InitializeEvent(0, 3000, 0);
    
    //===============
    // Loot System
    //===============
    // Wave 1
    InitializeEvent(0, 3100, 100); 
    InitializeEvent(1, 3100, 101); 
    InitializeEvent(2, 3100, 102); 
    InitializeEvent(3, 3100, 103); 
    InitializeEvent(4, 3100, 104); 
    InitializeEvent(5, 3100, 105); 
    InitializeEvent(6, 3100, 106); 
    
    // Wave 2
    InitializeEvent(0, 3101, 110); 
    InitializeEvent(10, 3100, 111); 
    InitializeEvent(11, 3100, 112); 
    InitializeEvent(12, 3100, 113); 
    InitializeEvent(13, 3100, 114); 
    InitializeEvent(14, 3100, 115); 
    InitializeEvent(15, 3100, 116); 
    InitializeEvent(16, 3100, 117); 
    InitializeEvent(17, 3100, 118); 
    InitializeEvent(18, 3100, 119); 
    
    // Wave 3
    InitializeEvent(20, 3100, 120); 
    InitializeEvent(21, 3100, 121); 
    InitializeEvent(22, 3100, 122); 
    InitializeEvent(23, 3100, 123); 
    InitializeEvent(24, 3100, 124); 
    InitializeEvent(25, 3100, 125); 
    InitializeEvent(26, 3100, 126); 
    InitializeEvent(27, 3100, 127); 
    InitializeEvent(28, 3100, 128); 
    InitializeEvent(29, 3100, 129); 
    InitializeEvent(30, 3100, 130); 
    InitializeEvent(31, 3100, 131); 
    InitializeEvent(32, 3100, 132); 
    InitializeEvent(33, 3100, 133); 
    InitializeEvent(34, 3100, 134); 
    InitializeEvent(35, 3100, 135); 
    InitializeEvent(36, 3100, 136); 
    InitializeEvent(37, 3100, 137); 
    InitializeEvent(38, 3100, 138); 
    InitializeEvent(39, 3100, 139); 
    InitializeEvent(40, 3100, 140); 
    InitializeEvent(41, 3100, 141); 
    InitializeEvent(42, 3100, 142); 
    InitializeEvent(43, 3100, 143); 
    InitializeEvent(44, 3100, 144); 
    InitializeEvent(45, 3100, 145); 
    InitializeEvent(46, 3100, 146); 
    InitializeEvent(47, 3100, 147); 
    InitializeEvent(48, 3100, 148); 
    InitializeEvent(49, 3100, 149); 
    InitializeEvent(50, 3100, 150); 
    InitializeEvent(51, 3100, 151); 
    InitializeEvent(52, 3100, 152); 
    InitializeEvent(53, 3100, 153); 
    InitializeEvent(54, 3100, 154); 
    InitializeEvent(55, 3100, 155); 
    InitializeEvent(56, 3100, 156); 
    InitializeEvent(57, 3100, 157); 
    InitializeEvent(58, 3100, 158); 
    InitializeEvent(59, 3100, 159); 
    
    // Wave 4
    InitializeEvent(1, 3101, 160); 
    InitializeEvent(2, 3101, 161);
    InitializeEvent(3, 3101, 162);
    
    // Wave 5
    InitializeEvent(0, 3102, 170);
    
    // Wave 6
    InitializeEvent(4, 3101, 180); 
    InitializeEvent(5, 3101, 181); 
    InitializeEvent(6, 3101, 182); 
    InitializeEvent(7, 3101, 183); 
    InitializeEvent(8, 3101, 184); 
    InitializeEvent(9, 3101, 185); 
    InitializeEvent(10, 3101, 186); 
    InitializeEvent(11, 3101, 187); 
    InitializeEvent(12, 3101, 188); 
    InitializeEvent(12, 3101, 189); 
    
    // Wave 7
    InitializeEvent(60, 3100, 190); 
    InitializeEvent(61, 3100, 191); 
    InitializeEvent(62, 3100, 192); 
    InitializeEvent(63, 3100, 193); 
    InitializeEvent(64, 3100, 194); 
    InitializeEvent(65, 3100, 195); 
    InitializeEvent(66, 3100, 196); 
    InitializeEvent(67, 3100, 197); 
    InitializeEvent(68, 3100, 198); 
    InitializeEvent(69, 3100, 199); 
    InitializeEvent(70, 3100, 200); 
    InitializeEvent(71, 3100, 201); 
    InitializeEvent(72, 3100, 202); 
    InitializeEvent(73, 3100, 203); 
    InitializeEvent(74, 3100, 204); 
    InitializeEvent(75, 3100, 205); 
    InitializeEvent(76, 3100, 206); 
    InitializeEvent(77, 3100, 207); 
    InitializeEvent(78, 3100, 208); 
    InitializeEvent(13, 3101, 209); 
    
    // Wave 8
    InitializeEvent(14, 3101, 210); 
    InitializeEvent(15, 3101, 211); 
    InitializeEvent(16, 3101, 212); 
    InitializeEvent(17, 3101, 213); 
    InitializeEvent(18, 3101, 214);
    InitializeEvent(19, 3101, 215);  
    
    // Wave 9
    InitializeEvent(20, 3101, 220); 
    InitializeEvent(21, 3101, 221);
    InitializeEvent(22, 3101, 222);
    InitializeEvent(23, 3101, 223);
    InitializeEvent(79, 3100, 224); 
    InitializeEvent(80, 3100, 225); 
    InitializeEvent(81, 3100, 226); 
    InitializeEvent(82, 3100, 227); 
    InitializeEvent(83, 3100, 228); 
    InitializeEvent(84, 3100, 229); 
    
    // Wave 10
    InitializeEvent(1, 3102, 230);
    
    // Wave 11
    InitializeEvent(24, 3101, 240); 
    InitializeEvent(25, 3101, 241); 
    InitializeEvent(26, 3101, 242); 
    
    // Wave 12
    InitializeEvent(27, 3101, 250); 
    InitializeEvent(28, 3101, 251); 
    InitializeEvent(29, 3101, 252); 
    InitializeEvent(30, 3101, 253); 
    InitializeEvent(31, 3101, 254); 
    InitializeEvent(32, 3101, 255); 
    InitializeEvent(33, 3101, 256); 
    InitializeEvent(34, 3101, 257); 
    InitializeEvent(35, 3101, 258); 
    InitializeEvent(36, 3101, 259); 
    
    // Wave 13
    InitializeEvent(37, 3101, 260); 
    InitializeEvent(85, 3100, 261); 
    InitializeEvent(86, 3100, 262); 
    InitializeEvent(87, 3100, 263); 
    InitializeEvent(88, 3100, 264); 
    InitializeEvent(89, 3100, 265); 
    InitializeEvent(90, 3100, 266); 
    InitializeEvent(91, 3100, 267); 
    InitializeEvent(92, 3100, 268); 
    InitializeEvent(93, 3100, 269); 
    
    // Wave 14
    InitializeEvent(93, 3100, 270); 
    InitializeEvent(94, 3100, 271);
    InitializeEvent(95, 3100, 272);
    InitializeEvent(96, 3100, 273);
    InitializeEvent(97, 3100, 274);
    InitializeEvent(98, 3100, 275);
    InitializeEvent(99, 3100, 276);
    InitializeEvent(100, 3100, 277);
    InitializeEvent(101, 3100, 278);
    InitializeEvent(102, 3100, 279);
    InitializeEvent(103, 3100, 280);
    InitializeEvent(104, 3100, 281);
    InitializeEvent(105, 3100, 282);
    InitializeEvent(106, 3100, 283);
    InitializeEvent(107, 3100, 284);
    InitializeEvent(108, 3100, 285);
    InitializeEvent(109, 3100, 286);
    InitializeEvent(110, 3100, 287);
    InitializeEvent(111, 3100, 288);
    InitializeEvent(38, 3101, 289); 
    
    // Wave 15
    InitializeEvent(0, 3103, 290);
});

//=================================================
// Marker System - <wave group id>
//=================================================
Event(3200, Default, function(X0_4) {
    SkipIfEventFlag(1, ON, TargetEventFlagType.EventFlag, 4592);
    ClearSpEffect(X0_4, 9991003);
    
    SkipIfEventFlag(1, OFF, TargetEventFlagType.EventFlag, 4592);
    SetSpEffect(X0_4, 9991003);
    
    EndUnconditionally(EventEndType.Restart);
});

//=================================================
// Trial System
//=================================================
Event(3000, Default, function() {
    ChangeCharacterEnableState(5300, Disabled);
    
    InitializeCommonEvent(6000, 0);
    
    WaitFixedTimeSeconds(5);
    
    //=================================================
    // Waves
    //=================================================
    // Wave 1 - Basic MT Wave
    InitializeEvent(0, 3001, 0);
    InitializeEvent(1, 3200, 5301);
    
    // Wave 2 - Light Cavalry + Basic MT Wave
    InitializeEvent(0, 3002, 0);
    InitializeEvent(2, 3200, 5302);
    
    // Wave 3 - Mass MT Wave
    InitializeEvent(0, 3003, 0);
    InitializeEvent(3, 3200, 5303);
    
    // Wave 4 - Heavy Cavalry * 1 + Light Cavalry * 2
    InitializeEvent(0, 3004, 0);
    InitializeEvent(4, 3200, 5304);
    
    // Wave 5 - Boss: Juggernaut
    InitializeEvent(0, 3005, 0);
    InitializeEvent(5, 3200, 5305);
    
    // Wave 6 - Ghost MTs
    InitializeEvent(0, 3006, 0);
    InitializeEvent(6, 3200, 5306);
    
    // Wave 7 - Warship + Drones
    InitializeEvent(0, 3007, 0);
    InitializeEvent(7, 3200, 5307);
    
    // Wave 8 - Institute MTs
    InitializeEvent(0, 3008, 0);
    InitializeEvent(8, 3200, 5308);
    
    // Wave 9 - Tetrapods * 2 + Light Cavalry * 2 + Quadcopters
    InitializeEvent(0, 3009, 0);
    InitializeEvent(9, 3200, 5309);
    
    // Wave 10 - Boss: Balteus
    InitializeEvent(0, 3010, 0);
    InitializeEvent(10, 3200, 5310);
    
    // Wave 11 - Helianthus Machines * 3
    InitializeEvent(0, 3011, 0);
    InitializeEvent(11, 3200, 5311);
    
    // Wave 12 - TOYBOX * 2 + Subject Guard MTs
    InitializeEvent(0, 3012, 0);
    InitializeEvent(12, 3200, 5312);
    
    // Wave 13 - Cataphract * 1 + Artillery
    InitializeEvent(0, 3013, 0);
    InitializeEvent(13, 3200, 5313);
    
    // Wave 14
    InitializeEvent(0, 3014, 0);
    InitializeEvent(14, 3200, 5314);
    
    // Wave 15 - Boss
    InitializeEvent(0, 3015, 0);
    InitializeEvent(15, 3200, 5315);
    
    WaitForEventFlag(ON, TargetEventFlagType.EventFlag, 4515);
    WaitFixedTimeSeconds(5);
    SetEventFlag(TargetEventFlagType.EventFlag, 4591, ON);
});

//=================================================
// Wave 1
//=================================================
Event(3001, Default, function() {
    const WaveStartText = 100;
    const WaveIntermission = 15;
    const WaveEndText = 90;
    
    // Wave Start:
    DisplayTextEffectMessage(WaveStartText);
    WaitFixedTimeSeconds(2);
    EndTextEffectMessage(3);
    
    // Enemies to Spawn:
    ChangeCharacterEnableState(100, Enabled);
    ChangeCharacterEnableState(101, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(102, Enabled);
    ChangeCharacterEnableState(103, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(104, Enabled);
    ChangeCharacterEnableState(105, Enabled);
    WaitRandomTimeSeconds(1, 3);
    
    // Wave Duration
    IfCharacterRatioDeadalive(OR_01, 5301, DeathState.Dead, Equal, 1);
    IfElapsedSeconds(OR_01, 180);
    IfConditionGroup(MAIN, PASS, OR_01);
    
    // Wave End:
    DisplayTextEffectMessage(WaveEndText);
    WaitFixedTimeSeconds(2);
    EndTextEffectMessage(3);
    
    // Rest Time
    WaitFixedTimeSeconds(WaveIntermission);
    
    SetEventFlag(TargetEventFlagType.EventFlag, 4501, ON);
});

//=================================================
// Wave 2
//=================================================
Event(3002, Default, function() {
    const WaveStartText = 101;
    const WaveIntermission = 15;
    const WaveEndText = 90;
    
    IfEventFlag(MAIN, ON, TargetEventFlagType.EventFlag, 4501);
    
    // Wave Start:
    DisplayTextEffectMessage(WaveStartText);
    WaitFixedTimeSeconds(2);
    EndTextEffectMessage(3);
    
    // Enemies to Spawn:
    ChangeCharacterEnableState(110, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(111, Enabled);
    ChangeCharacterEnableState(112, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(113, Enabled);
    ChangeCharacterEnableState(114, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(115, Enabled);
    ChangeCharacterEnableState(116, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(117, Enabled);
    ChangeCharacterEnableState(118, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(119, Enabled);
    WaitRandomTimeSeconds(1, 3);
    
    // Wave Duration
    IfCharacterRatioDeadalive(OR_01, 5302, DeathState.Dead, Equal, 1);
    IfElapsedSeconds(OR_01, 180);
    IfConditionGroup(MAIN, PASS, OR_01);
    
    // Wave End:
    DisplayTextEffectMessage(WaveEndText);
    WaitFixedTimeSeconds(2);
    EndTextEffectMessage(3);
    
    // Rest Time
    WaitFixedTimeSeconds(WaveIntermission);
    
    SetEventFlag(TargetEventFlagType.EventFlag, 4502, ON);
});

//=================================================
// Wave 3
//=================================================
Event(3003, Default, function() {
    const WaveStartText = 102;
    const WaveIntermission = 15;
    const WaveEndText = 90;
    
    IfEventFlag(MAIN, ON, TargetEventFlagType.EventFlag, 4502);
    
    // Wave Start:
    DisplayTextEffectMessage(WaveStartText);
    WaitFixedTimeSeconds(2);
    EndTextEffectMessage(3);
    
    // Enemies to Spawn:
    ChangeCharacterEnableState(120, Enabled);
    ChangeCharacterEnableState(130, Enabled);
    ChangeCharacterEnableState(140, Enabled);
    ChangeCharacterEnableState(150, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(121, Enabled);
    ChangeCharacterEnableState(131, Enabled);
    ChangeCharacterEnableState(141, Enabled);
    ChangeCharacterEnableState(151, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(122, Enabled);
    ChangeCharacterEnableState(132, Enabled);
    ChangeCharacterEnableState(142, Enabled);
    ChangeCharacterEnableState(152, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(123, Enabled);
    ChangeCharacterEnableState(133, Enabled);
    ChangeCharacterEnableState(143, Enabled);
    ChangeCharacterEnableState(153, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(124, Enabled);
    ChangeCharacterEnableState(134, Enabled);
    ChangeCharacterEnableState(144, Enabled);
    ChangeCharacterEnableState(154, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(125, Enabled);
    ChangeCharacterEnableState(135, Enabled);
    ChangeCharacterEnableState(145, Enabled);
    ChangeCharacterEnableState(155, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(126, Enabled);
    ChangeCharacterEnableState(136, Enabled);
    ChangeCharacterEnableState(146, Enabled);
    ChangeCharacterEnableState(156, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(127, Enabled);
    ChangeCharacterEnableState(137, Enabled);
    ChangeCharacterEnableState(147, Enabled);
    ChangeCharacterEnableState(157, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(128, Enabled);
    ChangeCharacterEnableState(138, Enabled);
    ChangeCharacterEnableState(148, Enabled);
    ChangeCharacterEnableState(158, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(129, Enabled);
    ChangeCharacterEnableState(139, Enabled);
    ChangeCharacterEnableState(149, Enabled);
    ChangeCharacterEnableState(159, Enabled);
    WaitRandomTimeSeconds(1, 3);
    
    // Wave Duration
    IfCharacterRatioDeadalive(OR_01, 5303, DeathState.Dead, Equal, 1);
    IfElapsedSeconds(OR_01, 180);
    IfConditionGroup(MAIN, PASS, OR_01);
    
    // Wave End:
    DisplayTextEffectMessage(WaveEndText);
    WaitFixedTimeSeconds(2);
    EndTextEffectMessage(3);
    
    // Rest Time
    WaitFixedTimeSeconds(WaveIntermission);
    
    SetEventFlag(TargetEventFlagType.EventFlag, 4503, ON);
});

//=================================================
// Wave 4
//=================================================
Event(3004, Default, function() {
    const WaveStartText = 103;
    const WaveIntermission = 15;
    const WaveEndText = 90;
    
    IfEventFlag(MAIN, ON, TargetEventFlagType.EventFlag, 4503);
    
    // Wave Start:
    DisplayTextEffectMessage(WaveStartText);
    WaitFixedTimeSeconds(2);
    EndTextEffectMessage(3);
    
    // Enemies to Spawn:
    ChangeCharacterEnableState(160, Enabled);
    ChangeCharacterEnableState(161, Enabled);
    ChangeCharacterEnableState(162, Enabled);
    
    // Wave Duration
    IfCharacterRatioDeadalive(OR_01, 5304, DeathState.Dead, Equal, 1);
    IfElapsedSeconds(OR_01, 180);
    IfConditionGroup(MAIN, PASS, OR_01);
    
    // Wave End:
    DisplayTextEffectMessage(WaveEndText);
    WaitFixedTimeSeconds(2);
    EndTextEffectMessage(3);
    
    // Rest Time
    WaitFixedTimeSeconds(WaveIntermission);
    
    SetEventFlag(TargetEventFlagType.EventFlag, 4504, ON);
});

//=================================================
// Wave 5
//=================================================
Event(3005, Default, function() {
    const WaveStartText = 104;
    const WaveIntermission = 15;
    const WaveEndText = 90;
    
    IfEventFlag(MAIN, ON, TargetEventFlagType.EventFlag, 4504);
    
    // Wave Start:
    DisplayTextEffectMessage(WaveStartText);
    WaitFixedTimeSeconds(2);
    EndTextEffectMessage(3);
    
    // Enemies to Spawn:
    ChangeCharacterEnableState(170, Enabled);
    
    // Wave Duration
    IfCharacterRatioDeadalive(MAIN, 5305, DeathState.Dead, Equal, 1);
    
    // Wave End:
    DisplayTextEffectMessage(WaveEndText);
    WaitFixedTimeSeconds(2);
    EndTextEffectMessage(3);
    
    // Rest Time
    WaitFixedTimeSeconds(WaveIntermission);
    
    SetEventFlag(TargetEventFlagType.EventFlag, 4505, ON);
});

//=================================================
// Wave 6
//=================================================
Event(3006, Default, function() {
    const WaveStartText = 105;
    const WaveIntermission = 15;
    const WaveEndText = 90;
    
    IfEventFlag(MAIN, ON, TargetEventFlagType.EventFlag, 4505);
    
    // Wave Start:
    DisplayTextEffectMessage(WaveStartText);
    WaitFixedTimeSeconds(2);
    EndTextEffectMessage(3);
    
    // Enemies to Spawn:
    ChangeCharacterEnableState(189, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(180, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(181, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(182, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(183, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(184, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(185, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(186, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(187, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(188, Enabled);
    
    // Wave Duration
    IfCharacterRatioDeadalive(OR_01, 5306, DeathState.Dead, Equal, 1);
    IfElapsedSeconds(OR_01, 180);
    IfConditionGroup(MAIN, PASS, OR_01);
    
    // Wave End:
    DisplayTextEffectMessage(WaveEndText);
    WaitFixedTimeSeconds(2);
    EndTextEffectMessage(3);
    
    // Rest Time
    WaitFixedTimeSeconds(WaveIntermission);
    
    SetEventFlag(TargetEventFlagType.EventFlag, 4506, ON);
});

//=================================================
// Wave 7
//=================================================
Event(3007, Default, function() {
    const WaveStartText = 106;
    const WaveIntermission = 15;
    const WaveEndText = 90;
    
    IfEventFlag(MAIN, ON, TargetEventFlagType.EventFlag, 4506);
    
    // Wave Start:
    DisplayTextEffectMessage(WaveStartText);
    WaitFixedTimeSeconds(2);
    EndTextEffectMessage(3);
    
    // Enemies to Spawn:
    ChangeCharacterEnableState(190, Enabled);
    ChangeCharacterEnableState(191, Enabled);
    ChangeCharacterEnableState(192, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(208, Enabled);
    ChangeCharacterEnableState(209, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(193, Enabled);
    ChangeCharacterEnableState(194, Enabled);
    ChangeCharacterEnableState(195, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(202, Enabled);
    ChangeCharacterEnableState(203, Enabled);
    ChangeCharacterEnableState(204, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(196, Enabled);
    ChangeCharacterEnableState(197, Enabled);
    ChangeCharacterEnableState(198, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(199, Enabled);
    ChangeCharacterEnableState(200, Enabled);
    ChangeCharacterEnableState(201, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(205, Enabled);
    ChangeCharacterEnableState(206, Enabled);
    ChangeCharacterEnableState(207, Enabled);
    
    // Wave Duration
    IfCharacterRatioDeadalive(OR_01, 5307, DeathState.Dead, Equal, 1);
    IfElapsedSeconds(OR_01, 180);
    IfConditionGroup(MAIN, PASS, OR_01);
    
    // Wave End:
    DisplayTextEffectMessage(WaveEndText);
    WaitFixedTimeSeconds(2);
    EndTextEffectMessage(3);
    
    // Rest Time
    WaitFixedTimeSeconds(WaveIntermission);
    
    SetEventFlag(TargetEventFlagType.EventFlag, 4507, ON);
});

//=================================================
// Wave 8
//=================================================
Event(3008, Default, function() {
    const WaveStartText = 107;
    const WaveIntermission = 15;
    const WaveEndText = 90;
    
    IfEventFlag(MAIN, ON, TargetEventFlagType.EventFlag, 4507);
    
    // Wave Start:
    DisplayTextEffectMessage(WaveStartText);
    WaitFixedTimeSeconds(2);
    EndTextEffectMessage(3);
    
    // Enemies to Spawn:
    ChangeCharacterEnableState(210, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(211, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(212, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(213, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(214, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(215, Enabled);
    
    // Wave Duration
    IfCharacterRatioDeadalive(OR_01, 5308, DeathState.Dead, Equal, 1);
    IfElapsedSeconds(OR_01, 180);
    IfConditionGroup(MAIN, PASS, OR_01);
    
    // Wave End:
    DisplayTextEffectMessage(WaveEndText);
    WaitFixedTimeSeconds(2);
    EndTextEffectMessage(3);
    
    // Rest Time
    WaitFixedTimeSeconds(WaveIntermission);
    
    SetEventFlag(TargetEventFlagType.EventFlag, 4508, ON);
});

//=================================================
// Wave 9
//=================================================
Event(3009, Default, function() {
    const WaveStartText = 108;
    const WaveIntermission = 15;
    const WaveEndText = 90;
    
    IfEventFlag(MAIN, ON, TargetEventFlagType.EventFlag, 4508);
    
    // Wave Start:
    DisplayTextEffectMessage(WaveStartText);
    WaitFixedTimeSeconds(2);
    EndTextEffectMessage(3);
    
    // Enemies to Spawn:
    ChangeCharacterEnableState(220, Enabled);
    WaitRandomTimeSeconds(3, 9);
    ChangeCharacterEnableState(228, Enabled);
    ChangeCharacterEnableState(229, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(226, Enabled);
    ChangeCharacterEnableState(227, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(222, Enabled);
    ChangeCharacterEnableState(224, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(225, Enabled);
    ChangeCharacterEnableState(223, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(221, Enabled);
    
    // Wave Duration
    IfCharacterRatioDeadalive(OR_01, 5309, DeathState.Dead, Equal, 1);
    IfElapsedSeconds(OR_01, 180);
    IfConditionGroup(MAIN, PASS, OR_01);
    
    // Wave End:
    DisplayTextEffectMessage(WaveEndText);
    WaitFixedTimeSeconds(2);
    EndTextEffectMessage(3);
    
    // Rest Time
    WaitFixedTimeSeconds(WaveIntermission);
    
    SetEventFlag(TargetEventFlagType.EventFlag, 4509, ON);
});

//=================================================
// Wave 10
//=================================================
Event(3010, Default, function() {
    const WaveStartText = 109;
    const WaveIntermission = 15;
    const WaveEndText = 90;
    
    IfEventFlag(MAIN, ON, TargetEventFlagType.EventFlag, 4509);
    
    // Wave Start:
    DisplayTextEffectMessage(WaveStartText);
    WaitFixedTimeSeconds(2);
    EndTextEffectMessage(3);
    
    // Enemies to Spawn:
    ChangeCharacterEnableState(230, Enabled);
    
    // Wave Duration
    IfCharacterHPRatio(MAIN, 230, LessOrEqual, 0, Equal, 1);
    
    // Balteus doesn't have a death anim, 
    // so we play an explosion and hide him
    SpawnOneshotSFX(TargetEntityType.Character, 230, 220, 6000111);
    WaitFixedTimeFrames(2);
    ChangeCharacterEnableState(230, Disabled);
    
    // Wave End:
    DisplayTextEffectMessage(WaveEndText);
    WaitFixedTimeSeconds(2);
    EndTextEffectMessage(3);
    
    // Rest Time
    WaitFixedTimeSeconds(WaveIntermission);
    
    SetEventFlag(TargetEventFlagType.EventFlag, 4510, ON);
});

//=================================================
// Wave 11
//=================================================
Event(3011, Default, function() {
    const WaveStartText = 110;
    const WaveIntermission = 15;
    const WaveEndText = 90;
    
    IfEventFlag(MAIN, ON, TargetEventFlagType.EventFlag, 4510);
    
    // Wave Start:
    DisplayTextEffectMessage(WaveStartText);
    WaitFixedTimeSeconds(2);
    EndTextEffectMessage(3);
    
    // Enemies to Spawn:
    ChangeCharacterEnableState(240, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(241, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(242, Enabled);
    
    // Wave Duration
    IfCharacterRatioDeadalive(OR_01, 5311, DeathState.Dead, Equal, 1);
    IfElapsedSeconds(OR_01, 180);
    IfConditionGroup(MAIN, PASS, OR_01);
    
    // Wave End:
    DisplayTextEffectMessage(WaveEndText);
    WaitFixedTimeSeconds(2);
    EndTextEffectMessage(3);
    
    // Rest Time
    WaitFixedTimeSeconds(WaveIntermission);
    
    SetEventFlag(TargetEventFlagType.EventFlag, 4511, ON);
});

//=================================================
// Wave 12
//=================================================
Event(3012, Default, function() {
    const WaveStartText = 111;
    const WaveIntermission = 15;
    const WaveEndText = 90;
    
    IfEventFlag(MAIN, ON, TargetEventFlagType.EventFlag, 4511);
    
    // Wave Start:
    DisplayTextEffectMessage(WaveStartText);
    WaitFixedTimeSeconds(2);
    EndTextEffectMessage(3);
    
    // Enemies to Spawn:
    ChangeCharacterEnableState(250, Enabled);
    ChangeCharacterEnableState(252, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(258, Enabled);
    ChangeCharacterEnableState(253, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(257, Enabled);
    ChangeCharacterEnableState(254, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(256, Enabled);
    ChangeCharacterEnableState(255, Enabled);
    WaitRandomTimeSeconds(1, 3);
    ChangeCharacterEnableState(259, Enabled);
    ChangeCharacterEnableState(251, Enabled);
    
    // Wave Duration
    IfCharacterRatioDeadalive(OR_01, 5312, DeathState.Dead, Equal, 1);
    IfElapsedSeconds(OR_01, 180);
    IfConditionGroup(MAIN, PASS, OR_01);
    
    // Wave End:
    DisplayTextEffectMessage(WaveEndText);
    WaitFixedTimeSeconds(2);
    EndTextEffectMessage(3);
    
    // Rest Time
    WaitFixedTimeSeconds(WaveIntermission);
    
    SetEventFlag(TargetEventFlagType.EventFlag, 4512, ON);
});

//=================================================
// Wave 13
//=================================================
Event(3013, Default, function() {
    const WaveStartText = 112;
    const WaveIntermission = 15;
    const WaveEndText = 90;
    
    IfEventFlag(MAIN, ON, TargetEventFlagType.EventFlag, 4512);
    
    // Wave Start:
    DisplayTextEffectMessage(WaveStartText);
    WaitFixedTimeSeconds(2);
    EndTextEffectMessage(3);
    
    // Enemies to Spawn:
    ChangeCharacterEnableState(260, Enabled);
    WaitRandomTimeSeconds(3, 9);
    ChangeCharacterEnableState(261, Enabled);
    ChangeCharacterEnableState(262, Enabled);
    ChangeCharacterEnableState(263, Enabled);
    WaitRandomTimeSeconds(3, 9);
    ChangeCharacterEnableState(264, Enabled);
    ChangeCharacterEnableState(265, Enabled);
    ChangeCharacterEnableState(266, Enabled);
    WaitRandomTimeSeconds(3, 9);
    ChangeCharacterEnableState(267, Enabled);
    ChangeCharacterEnableState(267, Enabled);
    ChangeCharacterEnableState(268, Enabled);
    
    // Wave Duration
    IfCharacterRatioDeadalive(OR_01, 5313, DeathState.Dead, Equal, 1);
    IfElapsedSeconds(OR_01, 180);
    IfConditionGroup(MAIN, PASS, OR_01);
    
    // Wave End:
    DisplayTextEffectMessage(WaveEndText);
    WaitFixedTimeSeconds(2);
    EndTextEffectMessage(3);
    
    // Rest Time
    WaitFixedTimeSeconds(WaveIntermission);
    
    SetEventFlag(TargetEventFlagType.EventFlag, 4513, ON);
});

//=================================================
// Wave 14
//=================================================
Event(3014, Default, function() {
    const WaveStartText = 113;
    const WaveIntermission = 15;
    const WaveEndText = 90;
    
    IfEventFlag(MAIN, ON, TargetEventFlagType.EventFlag, 4513);
    
    // Wave Start:
    DisplayTextEffectMessage(WaveStartText);
    WaitFixedTimeSeconds(2);
    EndTextEffectMessage(3);
    
    // Enemies to Spawn:
    ChangeCharacterEnableState(270, Enabled);
    ChangeCharacterEnableState(271, Enabled);
    ChangeCharacterEnableState(272, Enabled);
    ChangeCharacterEnableState(273, Enabled);
    ChangeCharacterEnableState(274, Enabled);
    ChangeCharacterEnableState(275, Enabled);
    ChangeCharacterEnableState(276, Enabled);
    ChangeCharacterEnableState(277, Enabled);
    ChangeCharacterEnableState(278, Enabled);
    ChangeCharacterEnableState(279, Enabled);
    ChangeCharacterEnableState(280, Enabled);
    ChangeCharacterEnableState(281, Enabled);
    ChangeCharacterEnableState(282, Enabled);
    ChangeCharacterEnableState(283, Enabled);
    ChangeCharacterEnableState(284, Enabled);
    ChangeCharacterEnableState(285, Enabled);
    ChangeCharacterEnableState(286, Enabled);
    ChangeCharacterEnableState(287, Enabled);
    ChangeCharacterEnableState(288, Enabled);
    WaitRandomTimeSeconds(3, 9);
    ChangeCharacterEnableState(289, Enabled);
    
    // Wave Duration
    IfCharacterRatioDeadalive(OR_01, 5314, DeathState.Dead, Equal, 1);
    IfElapsedSeconds(OR_01, 180);
    IfConditionGroup(MAIN, PASS, OR_01);
    
    // Wave End:
    DisplayTextEffectMessage(WaveEndText);
    WaitFixedTimeSeconds(2);
    EndTextEffectMessage(3);
    
    // Rest Time
    WaitFixedTimeSeconds(WaveIntermission);
    
    SetEventFlag(TargetEventFlagType.EventFlag, 4514, ON);
});

//=================================================
// Wave 15
//=================================================
Event(3015, Default, function() {
    const WaveStartText = 114;
    const WaveIntermission = 15;
    const WaveEndText = 90;
    
    IfEventFlag(MAIN, ON, TargetEventFlagType.EventFlag, 4514);
    
    // Wave Start:
    DisplayTextEffectMessage(WaveStartText);
    WaitFixedTimeSeconds(2);
    EndTextEffectMessage(3);
    
    // Enemies to Spawn:
    ChangeCharacterEnableState(290, Enabled);
    
    // Wave Duration
    IfCharacterRatioDeadalive(OR_01, 5315, DeathState.Dead, Equal, 1);
    IfConditionGroup(MAIN, PASS, OR_01);
    
    // Wave End:
    DisplayTextEffectMessage(WaveEndText);
    WaitFixedTimeSeconds(2);
    EndTextEffectMessage(3);
    
    // Rest Time
    WaitFixedTimeSeconds(WaveIntermission);
    
    SetEventFlag(TargetEventFlagType.EventFlag, 4515, ON);
});

//=================================================
// Loot System - Basic Enemies
//=================================================
Event(3100, Default, function(X0_4) {
    IfCharacterDeadalive(MAIN, X0_4, DeathState.Dead, Equal, 1);
    
    BatchSetEventFlags(4800, 4899, OFF); 
    RandomlySetEventFlagInRange(4800, 4849, ON); // 2% chance
    EndIfEventFlag(EventEndType.End, OFF, TargetEventFlagType.EventFlag, 4800);
    
    InitializeCommonEvent(6010, 0);
});

//=================================================
// Loot System - Tough Enemies
//=================================================
Event(3101, Default, function(X0_4) {
    IfCharacterDeadalive(MAIN, X0_4, DeathState.Dead, Equal, 1);
    
    BatchSetEventFlags(4800, 4899, OFF); 
    RandomlySetEventFlagInRange(4800, 4803, ON); // 25% chance
    EndIfEventFlag(EventEndType.End, OFF, TargetEventFlagType.EventFlag, 4800);
    
    InitializeCommonEvent(6010, 0);
});

//=================================================
// Loot System - Bosses
//=================================================
Event(3102, Default, function(X0_4) {
    IfCharacterDeadalive(MAIN, X0_4, DeathState.Dead, Equal, 1);
    
    InitializeCommonEvent(6010, 0);
});

//=================================================
// Loot System - Final Boss
//=================================================
Event(3103, Default, function(X0_4) {
    IfCharacterDeadalive(MAIN, X0_4, DeathState.Dead, Equal, 1);
    
    InitializeCommonEvent(6010, 0);
    
    // Special Item Here
});


